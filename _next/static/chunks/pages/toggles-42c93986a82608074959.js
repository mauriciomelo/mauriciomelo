(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[570],{752:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var r=n(5893),a=n(2809),o=n(809),s=n.n(o),i=n(266),c=n(4517),u=n(7294),l=n(5894),h=n(7272),p=n(8610),f=n(1156),d=n(324),g=n(5138),m=n(3278),j=n(6598),v=n(9008),x=n(1163),b=n(5152),y=n(1581),Z=n.n(y),O=n(3419),w=n(319),P=n(2404),C=n(8764).Buffer;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e){return C.from(e,"base64")}function T(e){return C.from(JSON.stringify(e,null,2)).toString("base64")}function D(e){var t=e.split("/"),n=(0,w.Z)(t);return{owner:n[0],repo:n[1],path:n.slice(2).join("/")}}var _=n(5258),N=n(2283);function q(e){var t=(0,N.cI)({mode:"onChange"}),n=t.control,a=t.handleSubmit;return(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,r.jsx)(h.Z,{variant:"overline",children:"Authenticate"}),(0,r.jsxs)("form",{onSubmit:a((function(t){e.onChange(t)})),children:[(0,r.jsx)(l.Z,{marginY:2,children:(0,r.jsx)(N.Qr,{name:"ghToken",control:n,defaultValue:"",render:function(e){var t=e.field;return(0,r.jsx)(_.Z,{placeholder:"GitHub Token",type:"password",inputProps:t,variant:"filled"})}})}),(0,r.jsx)(l.Z,{marginY:2,children:(0,r.jsx)(p.Z,{type:"submit",color:"primary",children:"submit"})})]})]})}var B=n(4260),J=n(8699);function W(e){return(0,r.jsx)("form",{onSubmit:e.handleCommit,autoComplete:"off",children:(0,r.jsx)(B.Z,{id:"outlined-adornment-amount",placeholder:"commit message",required:!0,inputProps:{maxLength:50},fullWidth:!0,value:e.message,onChange:function(t){var n;return null===(n=e.setMessage)||void 0===n?void 0:n.call(e,t.target.value)},endAdornment:(0,r.jsx)(J.Z,{position:"start",children:(0,r.jsx)(p.Z,{variant:"contained",type:"submit",disabled:!e.valid,children:"Commit changes"})})})})}function A(e){return(0,r.jsxs)("form",{children:[(0,r.jsx)(_.Z,{name:"path",defaultValue:e.path,placeholder:"owner/repo/file.json",label:"file path",onBlur:e.handlePathChange,variant:"outlined",fullWidth:!0,sx:{mb:3}}),(0,r.jsx)(_.Z,{name:"schemaPath",defaultValue:e.schemaPath,placeholder:"owner/repo/file.json",label:"schema path",onBlur:e.handlePathChange,variant:"outlined",fullWidth:!0,sx:{mb:3}}),(0,r.jsx)(_.Z,{name:"docPath",defaultValue:e.docPath,placeholder:"owner/repo/doc.md",label:"doc path",onBlur:e.handlePathChange,variant:"outlined",fullWidth:!0})]})}var I=n(190),V=n(4444),z=n.n(V);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=new(Z()),U=(0,b.default)((function(){return Promise.all([n.e(373),n.e(844)]).then(n.bind(n,760)).then((function(e){return e.Editor}))}),{ssr:!1,loadableGenerated:{webpack:function(){return[760]},modules:["toggles.tsx -> ../components/Toggles/Editor"]}});function X(){var e=u.useState(),t=(0,c.Z)(e,2),n=t[0],o=t[1],b=(0,x.useRouter)(),y=u.useState(""),Z=(0,c.Z)(y,2),w=Z[0],C=Z[1],k=u.useState(null),_=(0,c.Z)(k,2),N=_[0],B=_[1],J=b.query,V=J.path,G=J.schemaPath,X=J.docPath,H=Y(n,{path:V}),L=(0,c.Z)(H,2),Q=L[0],F=L[1],K=u.useState(Q),$=(0,c.Z)(K,2),ee=$[0],te=$[1],ne=Y(n,{path:G}),re=(0,c.Z)(ne,1)[0],ae=Y(n,{path:X,parseJson:!1}),oe=(0,c.Z)(ae,1)[0];u.useEffect((function(){te(Q)}),[Q]),u.useEffect((function(){C(function(e,t){var n=z()((0,I.updatedDiff)(e,t));return Object.entries(n).map((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];return"set ".concat(n," to ").concat(r)})).join(" & ")}(Q,ee))}),[ee]);var se=function(){var e=(0,i.Z)(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=(0,i.Z)(s().mark((function e(t){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,n.getToggles({path:V});case 3:return r=e.sent,a=M(M({},r.toggles),ee),e.next=7,n.updateToggles({path:V,sha:r.sha,toggles:a,message:w});case 7:F(a),C("");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Array.isArray(e))return;return d.Z(g.Z("/"),m.Z,j.Z(".json",""))(e)}(V),ue=R.compile(re)(ee);return n?(0,r.jsxs)(l.Z,{sx:{display:"flex",padding:4,paddingTop:10,margin:"auto",maxWidth:600,flexDirection:"column",height:"100%"},children:[(0,r.jsx)(v.default,{children:(0,r.jsx)("title",{children:ce})}),(0,r.jsx)(h.Z,{sx:{textTransform:"capitalize"},variant:"h3",gutterBottom:!0,component:"h1",children:ce}),(0,r.jsxs)(l.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(h.Z,{component:"h2",variant:"subtitle2",color:"gray",children:V}),(0,r.jsx)(p.Z,{color:"secondary",onClick:function(e){B(e.currentTarget)},children:"Configure"}),(0,r.jsx)(f.ZP,{open:Boolean(N),anchorEl:N,onClose:function(){B(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,r.jsx)(l.Z,{sx:{p:4,width:500},children:(0,r.jsx)(A,{path:V,schemaPath:G,docPath:X,handlePathChange:function(e){var t=e.target;console.log(t),b.push({query:M(M({},b.query),{},(0,a.Z)({},t.name,encodeURI(t.value)))})}})})})]}),(0,r.jsx)(U,{json:ee,schema:re,onChange:se}),(0,r.jsx)(l.Z,{mt:4,children:(0,r.jsx)(W,{message:w,setMessage:C,handleCommit:ie,valid:ue})}),(0,r.jsx)(l.Z,{sx:{py:10},children:(0,r.jsx)(O.Z,{children:oe})})]}):(0,r.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,r.jsx)(q,{onChange:function(e){var t=e.ghToken;o(function(e){var t=new P.v({auth:e});return{getToggles:function(e){return(0,i.Z)(s().mark((function n(){var r,a,o,i,c,u,l,h;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.path,a=e.parseJson,o=void 0===a||a,n.next=3,t.request("GET /repos/{owner}/{repo}/contents/{path}",D(r));case 3:if(i=n.sent,"content"in(c=i.data)){n.next=7;break}return n.abrupt("return");case 7:return u=S(c.content),l=u.toString("ascii"),h=o?JSON.parse(l):l,n.abrupt("return",{toggles:h,sha:c.sha});case 11:case"end":return n.stop()}}),n)})))()},updateToggles:function(t){return(0,i.Z)(s().mark((function n(){var r,a,o,i,c,u,l,h,p;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.path,a=t.sha,o=t.toggles,i=t.message,c=new P.v({auth:e}),u=T(o),n.next=5,c.request("PUT /repos/{owner}/{repo}/contents/{path}",E(E({},D(r)),{},{message:i,sha:a,content:u}));case 5:return l=n.sent,h=l.data,p={sha:h.content.sha},n.abrupt("return",p);case 9:case"end":return n.stop()}}),n)})))()}}}(t))}})})}function Y(e,t){var n=t.path,r=t.parseJson,a=u.useState({}),o=(0,c.Z)(a,2),s=o[0],i=o[1];return u.useEffect((function(){e&&n&&e.getToggles({path:n,parseJson:r}).then((function(e){var t=e.toggles;i(t)}))}),[e,n]),[s,i]}},3768:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/toggles",function(){return n(752)}])}},function(e){e.O(0,[774,54,488,760,811,888,179],(function(){return t=3768,e(e.s=t);var t}));var t=e.O();_N_E=t}]);